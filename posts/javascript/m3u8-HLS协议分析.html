<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>m3u8-HLS协议分析 | 幻无</title>
    <meta name="description" content="">
    <link rel="manifest" href="/manifest.json">
  <link rel="icon" href="/img/fire.png">
    
    <link rel="preload" href="/assets/css/0.styles.90809201.css" as="style"><link rel="preload" href="/assets/js/app.da4dd796.js" as="script"><link rel="preload" href="/assets/js/4.1c90529c.js" as="script"><link rel="preload" href="/assets/js/2.04037beb.js" as="script"><link rel="preload" href="/assets/js/1.067033b1.js" as="script"><link rel="preload" href="/assets/js/25.31359e66.js" as="script"><link rel="prefetch" href="/assets/js/10.0a199033.js"><link rel="prefetch" href="/assets/js/11.b2365ea9.js"><link rel="prefetch" href="/assets/js/12.16c787a9.js"><link rel="prefetch" href="/assets/js/13.93b5df4e.js"><link rel="prefetch" href="/assets/js/14.baee47e8.js"><link rel="prefetch" href="/assets/js/15.493a1a46.js"><link rel="prefetch" href="/assets/js/16.fd2a186e.js"><link rel="prefetch" href="/assets/js/17.4516ec91.js"><link rel="prefetch" href="/assets/js/18.781c4d82.js"><link rel="prefetch" href="/assets/js/19.28da4e75.js"><link rel="prefetch" href="/assets/js/20.26851181.js"><link rel="prefetch" href="/assets/js/21.946b349b.js"><link rel="prefetch" href="/assets/js/22.3063ce92.js"><link rel="prefetch" href="/assets/js/23.360b6d6e.js"><link rel="prefetch" href="/assets/js/24.dfa1da10.js"><link rel="prefetch" href="/assets/js/26.8ff57f41.js"><link rel="prefetch" href="/assets/js/27.fcc4745f.js"><link rel="prefetch" href="/assets/js/28.34665dc9.js"><link rel="prefetch" href="/assets/js/29.c3d6b1ad.js"><link rel="prefetch" href="/assets/js/30.198f364e.js"><link rel="prefetch" href="/assets/js/31.b214f6d4.js"><link rel="prefetch" href="/assets/js/32.c5c9f4ce.js"><link rel="prefetch" href="/assets/js/33.9046b1f7.js"><link rel="prefetch" href="/assets/js/34.4c57ce5c.js"><link rel="prefetch" href="/assets/js/35.77471822.js"><link rel="prefetch" href="/assets/js/36.923e3cdb.js"><link rel="prefetch" href="/assets/js/37.48a93dc5.js"><link rel="prefetch" href="/assets/js/5.58472d78.js"><link rel="prefetch" href="/assets/js/6.487aa439.js"><link rel="prefetch" href="/assets/js/7.6a9e2835.js"><link rel="prefetch" href="/assets/js/8.548f02cc.js"><link rel="prefetch" href="/assets/js/9.fe090da6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.90809201.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/fire.png" alt="幻无" class="logo"> <span class="site-name can-hide">幻无</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/frontEnd/" class="nav-link">frontEnd</a></li><li class="dropdown-item"><!----> <a href="/categories/backEnd/" class="nav-link">backEnd</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link">标签</a></div><div class="nav-item"><a href="/timeline/" class="nav-link">timeline</a></div><div class="nav-item"><a href="/about/" class="nav-link">about</a></div> <a href="https://github.com/zhaopande/zpblog.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/frontEnd/" class="nav-link">frontEnd</a></li><li class="dropdown-item"><!----> <a href="/categories/backEnd/" class="nav-link">backEnd</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link">标签</a></div><div class="nav-item"><a href="/timeline/" class="nav-link">timeline</a></div><div class="nav-item"><a href="/about/" class="nav-link">about</a></div> <a href="https://github.com/zhaopande/zpblog.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>m3u8-HLS协议分析</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/posts/javascript/m3u8-HLS%E5%8D%8F%E8%AE%AE%E5%88%86%E6%9E%90.html#hls介绍：" class="sidebar-link">HLS介绍：</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/posts/javascript/m3u8-HLS%E5%8D%8F%E8%AE%AE%E5%88%86%E6%9E%90.html#协议分析" class="sidebar-link">协议分析</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/posts/javascript/m3u8-HLS%E5%8D%8F%E8%AE%AE%E5%88%86%E6%9E%90.html#项目实践" class="sidebar-link">项目实践</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <div class="noscroll zp-hide"><main class="page"> <div class="theme-default-content"><h1 class="article-title">m3u8-HLS协议分析</h1> <div class="article-Info custom" data-v-95dff4c6><i class="iconfont zpicon-person" data-v-95dff4c6><span class="ml5" data-v-95dff4c6>幻无</span></i> <i class="iconfont zpicon-date" data-v-95dff4c6><span class="ml5" data-v-95dff4c6>2019-12-2</span></i> <i class="iconfont zpicon-book1 tags" data-v-95dff4c6><span class="tag-item" data-v-95dff4c6>j</span><span class="tag-item" data-v-95dff4c6>a</span><span class="tag-item" data-v-95dff4c6>v</span><span class="tag-item" data-v-95dff4c6>a</span><span class="tag-item" data-v-95dff4c6>s</span><span class="tag-item" data-v-95dff4c6>c</span><span class="tag-item" data-v-95dff4c6>r</span><span class="tag-item" data-v-95dff4c6>i</span><span class="tag-item" data-v-95dff4c6>p</span><span class="tag-item" data-v-95dff4c6>t</span></i> <i class="iconfont zpicon-view" data-v-8e322436 data-v-95dff4c6><span id="/posts/javascript/m3u8-HLS%E5%8D%8F%E8%AE%AE%E5%88%86%E6%9E%90.html" data-flag-title="Your Article Title" class="leancloud_visitors ml5" data-v-8e322436><span class="leancloud-visitors-count" data-v-8e322436></span></span></i></div> <hr> <div class="content__default"><p>最近项目要对接监控设备，和之前使用的RTSP协议(Real Time Streaming Protocol，实时流传输协议)不同，这次采用m3u8-HLS视频协议
</p> <h2 id="hls介绍："><a href="#hls介绍：" class="header-anchor">*</a> HLS介绍：</h2> <p><code>HLS 全称是 HTTP Live Streaming，是 Apple 提出的流媒体协议</code></p> <ul><li>M3U8是一种文件格式，是某些移动设备例如安卓，苹果手机浏览器缓存视频的“专用视频格式”。M3U8文件是指UTF-8编码格式的M3U文件，相当于M3U的特例情况。M3U文件是记录了一个索引纯文本文件，打开它时播放软件并不是播放它，而是根据它的索引找到对应的音视频文件的网络地址进行在线播放。</li> <li>M3U是一种播放多媒体列表的文件格式，它的设计初衷是为了播放音频文件，比如MP3，但是越来越多的软件现在用来播放视频文件列表，M3U也可以指定在线流媒体音频源。很多播放器和软件都支持M3U文件格式。</li> <li>M3U8主要的优点是可以做多码率的适配，根据网络带宽，客户端会自动选择一个适合自己码率的文件进行播放，保证视频流的流畅。它主要应用在移动设备上。</li></ul> <h2 id="协议分析"><a href="#协议分析" class="header-anchor">*</a> 协议分析</h2> <p>由于项目属于内网项目，开发测试时无法获取到真实视频数据，只能总网上找一些m3u8格式的视频地址去测试，这里发现的一个可以直接播放m3u8格式地址的测试网站
<a href="https://www.m3u8play.com/" target="_blank" rel="noopener noreferrer">https://www.m3u8play.com/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>,所以借助这个网站梳理下，
打开控制台后刷新一下页面，重新加载资源后可以看到下面这些东东，红框里面的两个文件， 对于用hls协议来解析一段视频来说，客户端通过xhr获取到的文件就是.m3u8 文件及对应的 .ts二进制流文件，服务端存储一份.m3u8文件然后对应了很多份的.ts流文件，可以理解成一对多的关系，.m3u8文件也类似于索引文件。
<img src="/img/js/m3u81.png" alt="Architecture of VuePress">
点击.msu8文件，可以看到下面这些内容，
<img src="/img/js/m3u82.png" alt="Architecture of VuePress">
红框里的是.mu38文件的头信息，是对视频资源的描述，下面就是索引列表，排列着视频的分片.ts流文件，下载下来后通过合并流文件最终形成视频播放文件</p> <div class="language-js extra-class"><pre class="language-js"><code>#<span class="token constant">EXT</span><span class="token operator">-</span><span class="token constant">X</span><span class="token operator">-</span><span class="token constant">VERSION</span><span class="token punctuation">:</span><span class="token number">3</span>            PlayList 的版本，可带可不带。下面有说明
#<span class="token constant">EXTM3U</span>                     m3u文件头
#<span class="token constant">EXT</span><span class="token operator">-</span><span class="token constant">X</span><span class="token operator">-</span><span class="token constant">TARGETDURATION</span><span class="token punctuation">:</span><span class="token number">11</span>    分片最大时长，单位为 s
#<span class="token constant">EXT</span><span class="token operator">-</span><span class="token constant">X</span><span class="token operator">-</span><span class="token constant">MEDIA</span><span class="token operator">-</span><span class="token constant">SEQUENCE</span><span class="token punctuation">:</span><span class="token number">0</span>     第一个<span class="token constant">TS</span>分片的序列号，如果没有，默认为 <span class="token number">0</span>
#<span class="token constant">EXT</span><span class="token operator">-</span><span class="token constant">X</span><span class="token operator">-</span><span class="token constant">ALLOW</span><span class="token operator">-</span><span class="token constant">CACHE</span>          是否允许cache
#<span class="token constant">EXT</span><span class="token operator">-</span><span class="token constant">X</span><span class="token operator">-</span><span class="token constant">ENDLIST</span>              m3u8文件结束符
#<span class="token constant">EXTINF</span>                     <span class="token function">指定每个媒体段</span><span class="token punctuation">(</span>ts<span class="token punctuation">)</span>的持续时间（秒），仅对其后面的<span class="token constant">URI</span>有效
</code></pre></div><p>读到这里可能有点纳闷，为啥只有一个.ts文件呢？不是一对多吗？不着急，当然是一对多，只不过刚打开页面，视频没有设置自动播放，所以只下载了一个分片的.ts文件，当点击开始播放按钮后，就开始下载了
<img src="/img/js/m3u83.png" alt="Architecture of VuePress"></p> <h2 id="项目实践"><a href="#项目实践" class="header-anchor">*</a> 项目实践</h2> <p>我们要把视频资源放到video元素上来播放，可是原生的video只支持MP4、OGG、WebM这几种格式，无法对m3u8格式进行直接解析播放，这里要借助<code>videojs/videojs-contrib-hls</code>的方案来解决，videojs它支持多个播放核心，而且插件非常多,还会自动检测浏览器对 HTML5 的支持情况，如果不支持 HTML5 则自动使用 Flash 播放器。</p> <ul><li>安装(根据项目选择引入方法)，css是必须引入的，要不然整个样式就会乱掉，由于是内网项目所以就直接考了一份。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>link href<span class="token operator">=</span><span class="token string">&quot;https://vjs.zencdn.net/7.5.5/video-js.css&quot;</span> rel<span class="token operator">=</span><span class="token string">&quot;stylesheet&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>

<span class="token comment">//es6</span>
npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev video<span class="token punctuation">.</span>js
npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev videojs<span class="token operator">-</span>contrib<span class="token operator">-</span>hls
<span class="token comment">//cdn</span>
<span class="token comment">//If you'd like to support IE8 (for Video.js versions prior to v7)</span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;https://vjs.zencdn.net/ie8/1.1.2/videojs-ie8.min.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><ul><li>安装成功完成后，就可以引入包使用了，这里封装成了一个组件，因为项目中需要从服务器中动态加载多个不同m3u8格式视频源，所以需要通过一个唯一值token来区分不同的摄像头，如果没有这个需求，直接在source中把路径写死就行了</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> videojs <span class="token keyword">from</span> <span class="token string">'video.js'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> player<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">CreateVideo</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createVideoDom</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createVideoDom</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function-variable function">createVideoDom</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> token <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
        <span class="token keyword">const</span> domId <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'myVideo'</span> <span class="token operator">+</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
            bigPlayButton<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><span class="token comment">//显示播放按钮</span>
            autoplay<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            controls<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//显示操作控件</span>
            controlBar<span class="token punctuation">:</span> <span class="token punctuation">{</span> fullscreenToggle<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            sources<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> src<span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://server/hls/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>token<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.m3u8</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> type<span class="token punctuation">:</span> <span class="token string">'application/x-mpegURL'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token comment">// sources: [{ src: 'https://node.imgio.in/demo/birds.m3u8', type: 'application/x-mpegURL' }],</span>
            <span class="token comment">// sourceOrder: true</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">//初始化播放实例</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>player <span class="token operator">=</span> <span class="token function">videojs</span><span class="token punctuation">(</span>domId<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">onPlayerReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">const</span> playPromise <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>playPromise <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                playPromise
                    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;audio played auto&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;playback prevented&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// How about an event listener?</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'ended'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;结束&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>player<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;连接异常&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span>
    <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'断开视频连接'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>player<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>player<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//销毁实例</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>player <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> height<span class="token punctuation">,</span> token<span class="token punctuation">,</span> time <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
            width<span class="token punctuation">:</span> <span class="token string">'inherit'</span><span class="token punctuation">,</span>
            height<span class="token punctuation">:</span> <span class="token string">'inherit'</span><span class="token punctuation">,</span>
            positoin<span class="token punctuation">:</span> <span class="token string">&quot;relative&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>video time<span class="token operator">=</span><span class="token punctuation">{</span>time<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token string">&quot;video-js vjs-default-skin&quot;</span> controls preload<span class="token operator">=</span><span class="token string">&quot;auto&quot;</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
                width<span class="token punctuation">:</span> <span class="token string">'inherit'</span><span class="token punctuation">,</span>
                height<span class="token punctuation">:</span> <span class="token string">'inherit'</span><span class="token punctuation">,</span>
                background<span class="token punctuation">:</span> <span class="token string">'#000'</span>
            <span class="token punctuation">}</span><span class="token punctuation">}</span> height<span class="token operator">=</span><span class="token punctuation">{</span>height<span class="token punctuation">}</span>
                id<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;myVideo&quot;</span> <span class="token operator">+</span> token<span class="token punctuation">}</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>source
                    type<span class="token operator">=</span><span class="token string">&quot;application/x-mpegURL&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>source<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>video<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>想看更多功能传送门在此 <a href="https://videojs.com/" target="_blank" rel="noopener noreferrer">https://videojs.com/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <ul><li>添加双击全屏需要引入<code>videojs-hotkeys</code>包，这个包不支持npm安装，建议直接去github复制下来，代码也没多少;引入成功后就支持双击全屏，当然还有很多配置项，可以参考文档</li></ul> <blockquote><p><a href="https://github.com/ctd1500/videojs-hotkeys" target="_blank" rel="noopener noreferrer">https://github.com/ctd1500/videojs-hotkeys<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//cdn</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;//cdn.sc.gl/videojs-hotkeys/latest/videojs.hotkeys.min.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div></div></div> <!----> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/9/2019, 4:11:26 PM</span></div></footer> <!----> </main></div> <div class="vcomment" data-v-7d43d2fc><div id="vcomments" data-v-7d43d2fc></div></div> <div class="back-top" data-v-5da94fee><i class="zpicon-airplane iconfont" data-v-5da94fee></i></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.da4dd796.js" defer></script><script src="/assets/js/4.1c90529c.js" defer></script><script src="/assets/js/2.04037beb.js" defer></script><script src="/assets/js/1.067033b1.js" defer></script><script src="/assets/js/25.31359e66.js" defer></script>
  </body>
</html>
